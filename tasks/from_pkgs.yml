---
- name: ensure dependencies are installed (Debian/Ubuntu)
  apt:
    name:
      - apt-transport-https
      - ca-certificates
      - gnupg2
    state: present
  when: ansible_os_family == "Debian"

# Ubuntu
- name: add the repository (Ubuntu)
  apt_repository:
    repo: "ppa:cz.nic-labs/knot-dns"
    state: present
  when: ansible_distribution == "Ubuntu"

# Debian
- name: add repository keys (Debian)
  apt_key:
    url: https://deb.knot-dns.cz/knot/apt.gpg
    state: present
  when: ansible_distribution == "Debian"

- name: add the repository (Debian)
  apt_repository:
    repo: "deb https://deb.knot-dns.cz/knot/ {{  ansible_distribution_release }} main"
    state: present
  when: ansible_distribution == "Debian"

# Debian Family (Debian, Ubuntu)
- name: make sure knot is installed (Debian/Ubuntu)
  apt:
    name: knot
    update_cache: yes
    state: present
  when: ansible_os_family == "Debian"

# FreeBSD Family
- name: packages (FreeBSD)
  pkgng:
    name: "dns/knot2"
    state: present
  when: ansible_os_family == "FreeBSD"

# RedHat Family (RedHat, Fendora, CentOS, Amazon, etc)
- name: make sure knot is installed (RedHat)
  yum:
    name: knot
    state: present
  when: ansible_os_family == "RedHat"
